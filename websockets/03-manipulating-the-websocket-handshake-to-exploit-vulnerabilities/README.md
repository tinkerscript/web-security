# Manipulating the WebSocket handshake to exploit vulnerabilities
PRACTITIONER

This online shop has a live chat feature implemented using WebSockets.

It has an aggressive but flawed XSS filter.

To solve the lab, use a WebSocket message to trigger an alert() popup in the support agent's browser.

## Решение
На вкладке Proxy -> WebSockets History можно обнаружить, что HTML entities кодируются на клиенте перед отправкой на сервер. Переправляю одно из сообщений в Repeater и подменяю контент нефильтрованной нагрузкой. Получаю ответ со статусом 401 и сообщением "This address is blacklisted".

Нажимаю Reconnect, добавляю заголовок `X-Forwarded-For: 192.168.12.1` и пробую другой пейлоад. При бане меняю значение X-Forwarded-For.

`{"message":"<img src=1 oNeRrOr=alert`1`>"}`

Задание выполнено.
